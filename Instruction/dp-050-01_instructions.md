# DP-050- SQL-Workloads から Azure への移行
# ラボ 1 - Azure アーキテクチャに関する考慮事項

**推定時間**: 50 分

**前提条件**: この演習を実行するための前提条件の手順はありません。

**ラボ ファイル**: このラボのファイル _Allfiles\Labfiles\Starter\DP-150.1_ フォルダにあります。

## ラボの概要

受講者は、Data Platform のモダナイゼイション、および、モダナイゼイション プロジェクトを高いレベルで組織が実施する理由とその方法について理解したことを、このモジュールで得た情報を使用して実際に説明します。Azure への移行のコストを決定する方法を実際に学習します。また、作業中の環境に関する情報も収集します。受講者は、特定のシナリオに使用する必要があるデータ プラットフォームのモダナイゼイション戦略を最終的に決定します。

## ラボの目的
  
この課題を完了すると、次のことができるようになります。

- データ プラットフォームのモダナイゼイションを説明する。
- 移行のステージを書き出す。
- データ移行テクノロジを説明する。

## シナリオ
  
最近、AdventureWorksのシニアデータ エンジニアとして採用され、コンサルタントやアーキテクトと協力して、組織の技術的要件とビジネス要件を満たすデータ プラットフォームのモダナイゼイション プロジェクトを開始しています。Azure への移行の総所有コスト（TCO）を計算します。ジュニア データ エンジニアに、Azure に移行する SQL Server に関する情報を収集してもらいます。次に、移行するのに最適な Azure データ プラットフォーム テクノロジを選択します。

## 演習 1: データ プラットフォームのモダナイゼイションを理解する

このラボでは、データベースを Azure に移行するためのコストを計算します。

推定時間: 約 15 分

この演習の主なタスクは次のとおりです。

1. マイクロソフトの総保有コスト（TCO）計算機を開く
1. サーバー ベースのワークロードの定義
1. ストレージを追加する
1. ネットワークの追加
1. 通貨の調整
1. 電気代の調整
1. その他の前提条件の調整
1. オンプレミスと Azure コストの比較

### 総保有コスト（TCO）計算機を開く

1. ブラウザを開いて、 Azure TCO Calculato 「+++https://azure.microsoft.com/pricing/tco/calculator/+++」 に移動します。
1. 「**ワークロードの定義**」 で、「**サーバー**」 セクションの既存のワークロードをすべて削除します。

### データベース ワークロードの入力をする

1. 「**データベース**」 で、既存のワークロードをすべて削除します。
1. **+ 会計** を選択します。
1. 「**名前**」 テキスト ボックスに、「**Accounting**」と入力します。
1. 「**ソース**」 セクションで、次の値を選択します。

    | プロパティ | 値 |
    | --- | --- |
    | データベース | Microsoft SQL Server |
    | ライセンス | Enterprise |
    | 環境 | 物理サーバー |
    | オペレーティング システム | Windows |
    | オペレーティング システム ライセンス | データセンター |
    | サーバー | 1 |
    | サーバーあたりのプロク | 1 |
    | プロクあたりのコア | 4 |
    | RAM (GB) | 64 |
    | 最適化の方法 | CPU |
    | SQL Server 2008/2008R2 | 右にスライド |

1. 「**宛先**」 セクションで、次の値を選択します。

    | プロパティ | 値 |
    | --- | --- |
    | サービス | SQL Server VM |
    | ディスクの種類 | SSD |
    | IOPS | 5000 |
    | SQL Server ストレージ | 32 GB |
    | SQL Server のバックアップ | 32 GB |

    > [!注]
    > SSD は、Azure の運用サーバーに推奨されるディスク タイプです。

### ストレージとネットワークのワークロードを入力します

1. 「**ストレージ**」 で、既存のワークロードをすべて削除し、「**+ストレージの追加**」 を選択します。
1. 次の値を入力します。

    | プロパティ | 値 |
    | --- | --- |
    | 名前 | ローカル ディスクの会計 |
    | ストレージ型 | ローカル ディスク/SAN |
    | ディスクの種類 | HDD |
    | 容量 | 3 TB |
    | バックアップ | 1 TB |
    | アーカイブ | 0 TB |

1. 「**ネットワーク**」 の**送信帯域幅**の制御で、「**1GB**」 を選択します。
1. ページの下部にある 「**Next**」。

### 前提条件を調整する

1. 「**前提条件の調整**」 セクションの 「**通貨**」 リストで、希望する通貨を選択します。
1. 「**ソフトウェアアシュアランスカバレッジ（Azureハイブリッド特典を提供）**」 で、**WindowsServer ソフトウェア アシュアランス カバレッ**ジ スライダーを右にスライドします。
1. **SQLServer ソフトウェア アシュアランス カバレッジ** スライダーを右にスライドします。

    > [!注]
    > **ソフトウェア アシュアランス** セクションのリンクを使用して、利用可能なアシュアランスの詳細を確認することが可能です。以降のセクションにも同様のリンクがあります。

1. **geo 冗長ストレージ（GRS）** で、**GRS の横にあるトグルがデータをプライマリ リージョンから数百マイル離れたセカンダリ リージョンにレプリケートする**がオフになっていることを確認します。
1. 「**仮想マシンのコスト**」 で、「**これを有効にして、B シリーズの仮想マシンを推奨しない**」 の横のトグルがオフになっていることを確認します。
1. 「**電気料金**」 の 「**KW 時間あたりの価格**」 テキストボックスに、現在地の現実的な値を入力します。

    > [!注]
    > おおよその電気料金は、[グローバル電気料金](https://www.statista.com/statistics/263492/electricity-prices-in-selected-countries/)で確認することができます。すべての価格は米ドル（$）です。お好みの通貨で、おおよその値に変換してください。

1. 「**ストレージ コスト**」 で、アプリを既定値のままにします。
1. 「**IT 人件費**」 のすべての既定値のままにします。
1. 「**その他の前提条件**」 で、各セクションをデプロイし、関連するコストを調べます。
1. ページの下部にある 「**Next**」。

### 5 年間のレポートを調査する

1. 「**レポートの表示**」 ページで、**時間枠**の既定値が **5 年**であることを確認してください。
1. 下にスクロールしてレポートを表示し、Azure と比較したオンプレミス システムの推定コストをメモします。次の情報をメモしてください。

    - オンプレミス ワークロードの支出の大半はどこにありますか?
    - Azure に移行することにした場合、最もコストを削減できる要素は何ですか？

1. 各セクションを順番に展開し、コストの内訳を調査する。
1. 場所、ネットワーク レイテンシ、またはデータ主権の要件に基づいて地域を変更し、コストの比較を調べます。

### 3 年間のレポートを調査する

1. ページの一番上までスクロールし、「**時間枠**」 テキストボックスで 「**3年**」 を選択します。
1. レポートまでスクロールし、オンプレミス システムと Azure のコストの見積もり内訳を調査する次の情報をメモしてください。

    - オンプレミスの支出の大半はどこにありますか?
    - Azure に移行することにした場合、最もコストを削減できる要素は何ですか？

1. 各セクションを順番に展開し、コストの内訳を調査する

この演習を完了した後、Azure TCO 計算機を使用して、AdventureWorks Corporation の会計サーバーとその関連データベースのオンプレミス展開とAzure 展開のコストの違いを特定しました。

## 演習 2: 移行のステージを理解する

この演習では、既存のサーバーの仕様を調べます。

推定時間: 約 15 分

この演習の主なタスクは次のとおりです。

1. 既存のサーバーが使用しているメモリの量を特定する
1. 既存のサーバーのCPUのタイプを検出する
1. 既存のサーバーのディスク構成を決定する

### サーバーで使用されているメモリの量を決定する

1. 教室環境で実行されている **LON-DEV-01** 仮想マシンにサインインします。ユーザー名は **administrator**、パスワードは **Pa55w.rd** です。
1. 選択した方法を使用して、サーバーが使用しているメモリの量を決定します。

    > **ヒント**: Windows のすべての最新バージョンに含まれているアプリケーションである 「システム情報」 を使用して、サーバーまたはデスクトップデ バイスに関する仕様を取得します。システム情報を開くには、「スタート」 を選択し、検索フィールドにシステム情報を入力します。

1. メモ帳に値をメモしてください。

### サーバーで使用されている CPU の量を決定します

1. 選択した方法を使用して、サーバーで CPU リソースがどのように使用されているかを判別します。
1. メモ帳で観察結果をメモしてください。

### サーバーで使用されているディスク構成を決定します

1. 選択した方法を使用して、サーバーで構成されているディスク構成を判別します。
1. メモ帳で構成をメモしてください。
1. メモ帳を _Allfiles\Labfiles\Starter\DP-150.1_ フォルダに保存し、ServerSpecs.txt という名前を付けます。

この演習を完了した後、サーバーのハードウェア仕様に関する情報を収集したことになります。

## 演習 3: Data Migration Technologies

この演習では、お客様がオンプレミスの SQL Server から Azure に移行するのに役立つデータプラットフォームテクノロジを選択します。

推定時間: 約 15 分

このエクササイズのタスクは次のとおりです。

1. シナリオ A の移行を容易にするために必要なデータベース テクノロジを特定します。
1. シナリオ B での移行を容易にするために必要なデータベース テクノロジを特定します。

### シナリオ A の移行を容易にするために必要なデータベース テクノロジを特定します。

1. 次のシナリオを読む

      お客様は、現在 Microsoft SQL Server 2008 のオンプレミス バージョンに存在する多くのデータベースを使用するアプリケーションを持っています。データベースの総フットプリントは 12 TB と大きく、年間数テラバイトずつ急増しています。このアプリケーションは、レポート機能に関して SQL Server Reporting Services とも緊密に統合されています。データベースを含む既存の SAN ストレージは、容量が限られており、拡張に費用がかかり、寿命が近づいています。アプリケーションは、中程度のトランザクション率で、会社にとって重要であり、ダウンタイムはビジネスに重大な影響を与えます。アプリケーションの可用性を最大限に高めるために変更を加えるには、小さなメンテナンス ウィンドウを使用できます。高い成長率により、DBAとシステム管理者がすべてを実行し続けるために費やす時間がますます増えています。

1. このシナリオから、どのデータベース プラットフォーム テクノロジが適切でしょうか？

### シナリオ B での移行を容易にするために必要なデータベース テクノロジを特定します。

1. 次のシナリオを読む

      お客様は、16 GB のメモリを搭載したクアッドコア SQL Server 上のデータベースに部門データを保持しています。サーバーは、スプレッドシートおよびアクセス フォームの単純なデータ アクセスへのバックエンドとして使用されます。350 MB のストレージを使用するデータベースは全部で 6 つあります。このサーバーへの最大同時接続数は 12 です。

1. このシナリオから、どのデータベース プラットフォーム テクノロジが適切でしょうか？

この演習を完了すると、移行プロジェクトに適した Azure データベース テクノロジが特定されます。

## ラボの復習

約 45 分後、インストラクターがこのラボを終了します。クラスで、各グループの調査結果について話し合います。